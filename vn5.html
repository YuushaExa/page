<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VN Posts</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
    .post { border: 1px solid #ddd; padding: 15px; margin-bottom: 10px; border-radius: 8px; }
    .post img { max-width: 200px; max-height: 200px; }
    .loading { text-align: center; padding: 20px; }
    .pagination { display: flex; gap: 10px; margin-top: 20px; }
    .post-detail { margin-top: 20px; padding: 15px; border: 1px solid #eee; }
  </style>
</head>
<body>
  <div id="app">
    <h1>VN Posts</h1>
    <div id="posts-container" class="loading">Loading posts...</div>
    <div id="pagination" class="pagination"></div>
    <div id="post-detail" class="post-detail" style="display: none;"></div>
  </div>
  <script>
// State
let currentPage = 1;
const API_BASE = 'https://yuushaexa.github.io/headless';

// DOM Elements
const postsContainer = document.getElementById('posts-container');
const paginationEl = document.getElementById('pagination');
const postDetailEl = document.getElementById('post-detail');

// Initialize
document.addEventListener('DOMContentLoaded', () => {
  // Handle initial load or History API navigation (back/forward)
  window.addEventListener('popstate', handleRoute);
  handleRoute();
});

// Route handler (for History API)
function handleRoute() {
  const path = window.location.pathname.split('/').filter(Boolean);
  const hash = window.location.hash.substring(1);

  if (path[0] === 'posts' && path[1]) {
    // Post detail view (e.g., /posts/driven-by-madness)
    const postSlug = path[1];
    loadPostDetail(`vn/posts/${postSlug}.json`);
  } else if (hash.startsWith('page-')) {
    // Paginated list (e.g., #page-2)
    currentPage = parseInt(hash.split('-')[1]);
    fetchPosts(currentPage);
  } else {
    // Default view (page 1)
    currentPage = 1;
    fetchPosts(1);
  }
}

// Fetch posts from API
async function fetchPosts(page = 1) {
  postsContainer.innerHTML = '<div class="loading">Loading posts...</div>';
  postDetailEl.style.display = 'none';

  try {
    const response = await fetch(`${API_BASE}/vn/posts/${page === 1 ? 'index' : `page/${page}`}.json`);
    const data = await response.json();
    renderPosts(data.posts);
    renderPagination(data.pagination);

    // Update URL without reload (e.g., #page-2)
    window.history.pushState({}, '', `#page-${page}`);
    document.title = `VN Posts - Page ${page}`;
  } catch (error) {
    postsContainer.innerHTML = `<div class="error">Failed to load posts: ${error.message}</div>`;
  }
}

// Render posts
function renderPosts(posts) {
  postsContainer.innerHTML = posts
    .map(post => {
      const postSlug = post.link.replace('vn/posts/', '').replace('.json', '');
      return `
        <div class="post" data-id="${post.id}">
          <h3><a href="/posts/${postSlug}" onclick="navigateToPost(event, '${post.link}')">${post.title}</a></h3>
          ${post.image?.url ? `<img src="${post.image.url}" alt="${post.title}">` : ''}
        </div>
      `;
    })
    .join('');
}

// Navigate to post (with History API)
function navigateToPost(event, postLink) {
  event.preventDefault();
  const postSlug = postLink.replace('vn/posts/', '').replace('.json', ');
  window.history.pushState({}, '', `/posts/${postSlug}`);
  document.title = `VN Post - ${event.target.textContent}`;
  loadPostDetail(postLink);
}

// Load post detail
async function loadPostDetail(postLink) {
  postsContainer.style.display = 'none';
  paginationEl.style.display = 'none';
  postDetailEl.style.display = 'block';
  postDetailEl.innerHTML = '<div class="loading">Loading post details...</div>';

  try {
    const response = await fetch(`${API_BASE}/${postLink}`);
    const post = await response.json();
    renderPostDetail(post);
  } catch (error) {
    postDetailEl.innerHTML = `<div class="error">Failed to load post: ${error.message}</div>`;
  }
}

// Render post detail
function renderPostDetail(post) {
  postDetailEl.innerHTML = `
    <h2>${post.title}</h2>
    ${post.image?.url ? `<img src="${post.image.url}" alt="${post.title}" style="max-width: 300px;">` : ''}
    <p>${post.description || 'No description available.'}</p>
    ${post.developers?.length ? `
      <h4>Developers:</h4>
      <ul>
        ${post.developers.map(dev => `<li>${dev.title}</li>`).join('')}
      </ul>
    ` : ''}
    <button onclick="backToPosts()">Back to Posts</button>
  `;
}

// Back to posts list
function backToPosts() {
  window.history.pushState({}, '', '/');
  document.title = 'VN Posts';
  postsContainer.style.display = 'block';
  paginationEl.style.display = 'flex';
  postDetailEl.style.display = 'none';
  fetchPosts(currentPage);
}

// Render pagination
function renderPagination(pagination) {
  paginationEl.innerHTML = `
    ${pagination.previousPage ? `<button onclick="changePage(${currentPage - 1})">Previous</button>` : ''}
    <span>Page ${pagination.currentPage} of ${pagination.totalPages}</span>
    ${pagination.nextPage ? `<button onclick="changePage(${currentPage + 1})">Next</button>` : ''}
  `;
}

// Change page
function changePage(page) {
  currentPage = page;
  fetchPosts(page);
}  
  </script>
</body>
</html>
