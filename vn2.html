<!DOCTYPE html>
<html lang="en" x-data="visualNovelApp()">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Visual Novels</title>
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    .vn-container {
      border: 1px solid #ddd;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 5px;
    }
    .vn-title {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    .vn-title a {
      text-decoration: none;
      color: #007bff;
    }
    .vn-title a:hover {
      text-decoration: underline;
    }
    .vn-description {
      font-size: 16px;
      color: #555;
      margin-bottom: 10px;
    }
    .vn-image {
      max-width: 100%;
      height: auto;
      margin-bottom: 10px;
    }
    .pagination {
      margin-top: 20px;
      text-align: center;
    }
    .pagination a {
      margin: 0 5px;
      text-decoration: none;
      color: #007bff;
    }
    .pagination a.active {
      font-weight: bold;
      color: #000;
    }
    .vn-developers, .vn-tags, .vn-screenshots {
      margin-bottom: 10px;
    }
    .vn-developers ul, .vn-tags ul, .vn-screenshots ul {
      list-style-type: none;
      padding: 0;
    }
    .vn-developers li, .vn-tags li {
      display: inline-block;
      margin-right: 10px;
      background-color: #f0f0f0;
      padding: 5px 10px;
      border-radius: 3px;
    }
    .vn-screenshots img {
      max-width: 100px;
      margin-right: 10px;
    }
    #details-container {
      display: none;
    }
    #back-to-index {
      display: block;
      margin-top: 20px;
      text-decoration: none;
      color: #007bff;
    }
    .vn-post-image {
      max-width: 50px;
      height: auto;
      margin-left: 10px;
    }
    [x-cloak] { display: none !important; }
  </style>
</head>
<body x-cloak>
  <header>
    <h1 x-text="pageTitle">Visual Novels</h1>
    <input 
      type="text" 
      x-model="searchQuery" 
      @input.debounce="searchVisualNovels()"
      placeholder="Search Visual Novels..." 
      style="width: 100%; padding: 10px; margin-bottom: 20px;"
    >
  </header>
  
  <main>
    <section x-show="currentView === 'index'">
      <div id="search-results" style="margin-top: 10px;" x-show="searchResults.length > 0">
        <template x-for="post in searchResults" :key="post.link">
          <div class="vn-container">
            <div class="vn-title">
              <a href="#" @click.prevent="fetchAndRenderDetails(post.link)" x-text="post.title"></a>
            </div>
            <div class="vn-description" x-text="post.description"></div>
            <img x-show="post.image?.url" class="vn-image" :src="post.image.url" :alt="post.title">
          </div>
        </template>
      </div>
      
      <div id="vn-list" x-show="searchResults.length === 0">
        <template x-for="post in posts" :key="post.link">
          <div class="vn-container">
            <div class="vn-title">
              <a href="#" @click.prevent="fetchAndRenderDetails(post.link)" x-text="post.title"></a>
            </div>
            <div class="vn-description" x-text="post.description"></div>
            <img x-show="post.image?.url" class="vn-image" :src="post.image.url" :alt="post.title">
          </div>
        </template>
      </div>
      
      <div class="pagination" x-show="pagination && searchResults.length === 0">
        <a 
          href="#" 
          @click.prevent="fetchVisualNovels(pagination.previousPage)" 
          x-show="pagination.previousPage"
        >
          Previous
        </a>
        <span x-text="'Page ' + pagination.currentPage + ' of ' + pagination.totalPages"></span>
        <a 
          href="#" 
          @click.prevent="fetchVisualNovels(pagination.nextPage)" 
          x-show="pagination.nextPage"
        >
          Next
        </a>
      </div>
    </section>
    
    <section id="details-container" x-show="currentView === 'details'">
      <article id="vn-details">
        <div class="vn-title" x-text="currentPost.title"></div>
        <div class="vn-description" x-text="currentPost.description"></div>
        <img 
          x-show="currentPost.image?.url" 
          class="vn-image" 
          :src="currentPost.image.url" 
          :alt="currentPost.title"
        >
        
        <div class="vn-developers" x-show="currentPost.developers?.length">
          <strong>Developers:</strong>
          <ul>
            <template x-for="developer in currentPost.developers" :key="developer.link">
              <li>
                <a href="#" @click.prevent="fetchAndRenderDeveloperDetails(developer.link)" x-text="developer.title"></a>
              </li>
            </template>
          </ul>
        </div>
        
        <div class="vn-tags" x-show="currentPost.tags?.length">
          <strong>Tags:</strong>
          <ul>
            <template x-for="tag in currentPost.tags" :key="tag">
              <li x-text="tag"></li>
            </template>
          </ul>
        </div>
        
        <div class="vn-screenshots" x-show="currentPost.screenshots?.length">
          <strong>Screenshots:</strong>
          <ul>
            <template x-for="screenshot in currentPost.screenshots" :key="screenshot.url">
              <li><img :src="screenshot.url" alt="Screenshot"></li>
            </template>
          </ul>
        </div>
      </article>
      <a href="#" id="back-to-index" @click.prevent="showIndexPage()">Back to List</a>
    </section>
  </main>
  
  <footer>
    2025
  </footer>

  <script>
    document.addEventListener('alpine:init', () => {
      Alpine.data('visualNovelApp', () => ({
        baseUrl: 'https://yuushaexa.github.io/headless/',
        hobby: 'vn',
        posts: [],
        pagination: null,
        currentPost: {},
        currentView: 'index',
        pageTitle: 'Visual Novels',
        searchQuery: '',
        searchResults: [],
        
        init() {
          this.fetchVisualNovels(`${this.baseUrl}${this.hobby}/posts/index.json`);
        },
        
        async fetchVisualNovels(url) {
          try {
            const response = await fetch(url);
            if (!response.ok) throw new Error('Network response was not ok');
            const data = await response.json();
            this.posts = data.posts;
            this.pagination = data.pagination;
          } catch (error) {
            console.error('Error fetching visual novels:', error);
          }
        },
        
        async searchVisualNovels() {
          if (!this.searchQuery.trim()) {
            this.searchResults = [];
            return;
          }
          
          try {
            const response = await fetch(`${this.baseUrl}${this.hobby}/posts/index.json`);
            if (!response.ok) throw new Error('Network response was not ok');
            const data = await response.json();
            
            const query = this.searchQuery.toLowerCase();
            this.searchResults = data.posts.filter(post => 
              post.title.toLowerCase().includes(query) || 
              post.description.toLowerCase().includes(query)
            );
          } catch (error) {
            console.error('Error searching visual novels:', error);
          }
        },
        
        async fetchAndRenderDetails(vnLink) {
          try {
            const response = await fetch(`${this.baseUrl}${vnLink}`);
            if (!response.ok) throw new Error('Network response was not ok');
            this.currentPost = await response.json();
            this.showDetailsPage();
          } catch (error) {
            console.error('Error fetching visual novel details:', error);
          }
        },
        
        async fetchAndRenderDeveloperDetails(developerLink) {
          try {
            const response = await fetch(`${this.baseUrl}${developerLink}`);
            if (!response.ok) throw new Error('Network response was not ok');
            this.currentPost = await response.json();
            this.showDetailsPage();
          } catch (error) {
            console.error('Error fetching developer details:', error);
          }
        },
        
        showIndexPage() {
          this.currentView = 'index';
          this.pageTitle = 'Visual Novels';
        },
        
        showDetailsPage() {
          this.currentView = 'details';
          this.pageTitle = 'Details';
        }
      }));
    });
  </script>
</body>
  </html>
